# 万象行者 - The Codex Walker

## 项目概述
一个基于HTML5的互动视觉小说游戏，讲述转校生陈星与神秘"图书管理员"魏娇娇的奇幻冒险故事。游戏采用纯视频演出模式和模块化架构设计，支持多分支剧情、沉浸式视频体验和丰富的互动选择。

## 🎮 游戏故事
在青藤高中，转校生陈星意外遇到了一个执行神秘"协议"的女生魏娇娇。当他发现自己能够看见"世界的另一面"时，一个关于"法典(Codex)"、"万象行者"和"蚀影体"的宏大世界观逐渐展开。作为一名未被记录在案的"万象行者"，陈星必须在"监察局"发现他之前做出选择...

### 主要角色
- **陈星** - 转校生男主角，拥有"认知敏感"能力的潜在"万象行者"
- **魏娇娇** - 神秘女主角，代号"卡珊德拉"的"图书管理员"，负责维护现实的稳定

## 技术栈
- **前端**: HTML5 + CSS3 + ES6 JavaScript
- **架构**: 模块化设计，MVC模式
- **视频格式**: MP4格式支持
- **音频格式**: MP3/OGG格式支持
- **部署**: 本地HTTP服务器

## ✨ 游戏特色
- 🎬 **纯视频演出** - 完全基于视频的沉浸式体验
- 🌟 **扩充版台词** - 深度的角色对话和世界观构建
- 🎭 **多分支剧情** - 三条主要路线（EVA、Saber、D.Va）和多种结局
- 🌍 **宏大世界观** - "法典"、"万象行者"、"蚀影体"的奇幻设定
- 📱 **响应式设计** - 支持多种设备和屏幕尺寸
- 🔧 **模块化架构** - 易于扩展和维护的代码结构
- 🔄 **动态内容加载** - "关于"页面内容从外部文件动态加载
- ⏯️ **播放模式切换** - 支持自动播放和手动播放模式，并提供清晰的UI指示
- 🎵 **智能音频控制** - 统一的音频管理系统，支持音量控制和淡入淡出效果
- ✨ **电影级过渡效果** - 多种专业过渡动画，提升视觉体验
- 🚀 **智能资源预加载** - 优化加载性能，减少等待时间
- 🎯 **路线管理系统** - 完整的分支剧情管理和进度跟踪

## 核心架构

### 主要模块
1. **GameController.js** - 游戏主控制器
   - 管理游戏状态和界面切换
   - 处理用户交互和事件
   - 协调各个模块的工作
   - 控制音频系统和播放模式

2. **SceneDataManager.js** - 场景数据管理器
   - 异步加载所有章节的场景和法典数据
   - 提供通过ID快速查找场景和法典词条的功能

3. **GameStateManager.js** - 游戏状态管理器
   - 管理游戏的核心状态，如当前场景ID、自动播放状态等
   - 提供存档和读档功能（基于localStorage）

4. **UIManager.js** - 界面管理器
   - 控制所有UI元素的显示、隐藏和内容更新
   - 管理对话框、角色名称、选项、菜单等
   - 动态加载和显示"关于"页面
   - 更新自动/手动播放的状态指示器

5. **ScenePlayer.js** - 场景播放器
   - 负责执行和渲染当前场景
   - 处理对话、旁白、选项和视频播放
   - 根据游戏状态（如自动播放）控制场景流程

6. **MusicManager.js** - 音频管理器
   - 统一管理所有视频的音频播放
   - 提供音乐开关、音量控制功能
   - 支持音频淡入淡出效果
   - 智能处理浏览器自动播放策略

7. **TransitionManager.js** - 过渡效果管理器
   - 提供多种电影级页面过渡动画
   - 智能选择适合的过渡效果
   - 支持自定义过渡文本和音效
   - 提升用户体验的视觉效果

8. **AssetLoader.js** - 资源预加载器
   - 智能预加载视频资源
   - 优化游戏性能和加载体验
   - 管理资源缓存策略

9. **RouteManager.js** - 路线管理器
   - 管理多条剧情路线和分支
   - 处理路线解锁条件和奖励系统
   - 跟踪玩家选择和进度
   - 计算最佳结局条件

### 剧情分支设计
游戏采用四幕式结构，包含多个关键选择点：

1. **第一幕：操场初遇** (`act1`)
   - 男主转校第一天的内心独白
   - 与女主的初次相遇
   - 第一个重要选择：如何回应女主的"中二台词"

2. **第二幕：午夜结界** (`act2`)
   - 夜晚校园的神秘事件
   - 女主真实身份的初步揭露
   - 关键路线选择：EVA/Saber/D.Va三条路线

3. **第三幕：路线分歧** (`act3`)
   - **EVA路线**: 人类补完计划主题
   - **Saber路线**: 骑士道精神主题  
   - **D.Va路线**: 星际维和部队主题

4. **第四幕：月光坦白** (`act4`)
   - 女主身份的完全揭露
   - 最终选择：是否加入"伪装计划"
   - 三种结局：好结局/中性结局/坏结局

## 文件结构
```
hudongdemo2/
├── index.html              # 项目首页
├── game.html               # 游戏主页面
├── about.html              # 关于页面
├── ending_credits.html     # 游戏结尾页面
├── style.css               # 全局样式
├── README.md               # 项目说明文档
├── CONTENT_INVENTORY.md    # 内容清单（台词/视频节点）
├── video_naming_guide.md   # 视频文件命名规范
├── GITHUB_DEPLOY.md        # GitHub部署说明
├── css/
│   └── game-ui.css         # 游戏界面样式
├── js/                     # JavaScript模块
│   ├── GameController.js   # 游戏主控制器
│   ├── SceneDataManager.js # 场景数据管理
│   ├── GameStateManager.js # 游戏状态管理
│   ├── UIManager.js        # 界面管理
│   ├── ScenePlayer.js      # 场景播放器
│   ├── MusicManager.js     # 音频管理器
│   ├── TransitionManager.js # 过渡效果管理器
│   ├── AssetLoader.js      # 资源预加载器
│   └── RouteManager.js     # 路线管理器
├── data/                   # 游戏数据
│   ├── act1.json           # 第一幕场景数据
│   ├── act2.json           # 第二幕场景数据
│   ├── act3.json           # 第三幕场景数据
│   ├── act4.json           # 第四幕场景数据
│   └── codex.json          # 法典词条数据
├── game/                   # 游戏资源目录
│   ├── audio/              # 音频资源
│   │   ├── bgm/            # 背景音乐
│   │   ├── sfx/            # 音效文件
│   │   └── voice/          # 语音文件
│   ├── images/             # 图像资源
│   │   ├── backgrounds/    # 背景图片
│   │   ├── characters/     # 角色立绘
│   │   └── ui/             # UI元素
│   └── videos/             # 视频文件
│       ├── backgrounds/    # 背景视频
│       └── cutscenes/      # 过场动画
└── test.mp4                # 测试视频文件
```

## 🚀 快速开始

### 环境要求
- 现代浏览器（支持ES6+）
- 本地HTTP服务器（推荐使用Python或Node.js）

### 获取项目
```bash
# 克隆仓库
git clone https://github.com/chenxing3060/hudongdemo2.git
cd hudongdemo2
```

### 启动游戏
1. 在项目根目录启动HTTP服务器：
   ```bash
   # 使用Python 3
   python3 -m http.server 5173
   
   # 或使用Node.js
   npx http-server -p 5173
   ```

2. 在浏览器中访问：`http://localhost:5173/game.html`

### 游戏操作
- **封面页面**: 点击屏幕进入开始菜单
- **开始菜单**: 点击"开始游戏"开始新游戏
- **游戏中**: 点击对话框继续剧情，通过菜单可切换自动/手动播放模式

### 在线体验
项目已部署到GitHub Pages，可直接访问：
- 游戏地址：`https://chenxing3060.github.io/hudongdemo2/game.html`
- 项目首页：`https://chenxing3060.github.io/hudongdemo2/`

## 🔧 开发状态

### 已完成功能 ✅
- [x] 模块化游戏架构
- [x] 完整的四幕式剧情结构
- [x] 异步场景和法典数据加载
- [x] 视频背景和过场动画播放
- [x] 多分支选择系统
- [x] 游戏状态管理和本地存档
- [x] 响应式界面设计
- [x] 动态加载"关于"页面
- [x] 自动/手动播放模式切换及UI指示
- [x] 智能音频控制系统
- [x] 电影级页面过渡效果
- [x] 智能资源预加载机制
- [x] 路线管理和分支系统
- [x] 内容清单管理
- [x] 双结局系统（搭档结局/恋人结局）
- [x] 结尾页面和完整游戏流程
- [x] 名词解释系统（法典词条高亮显示）
- [x] 页面重定向功能

### 待完善内容 🚧
- [ ] 角色立绘显示系统
- [ ] 音效系统（点击、选择、战斗音效）
- [ ] 语音配音系统

### 计划功能 📋
- [ ] 成就系统
- [ ] 多语言支持
- [ ] 云存档功能

## 📝 更新日志

### v1.5.0 (当前版本)
- ✨ **新增**: 实现双结局系统（搭档结局/恋人结局），提供不同的故事走向
- ✨ **新增**: 创建精美的结尾页面，包含完整的游戏完成提示和返回功能
- ✨ **新增**: 添加名词解释系统，游戏中的专业术语可点击查看详细说明
- ✨ **新增**: 实现页面重定向功能，支持从游戏内跳转到外部页面
- 🔧 **修复**: 修复了结局后无法跳转到结尾页面的关键问题
- 🔧 **修复**: 修复了名词解释数据结构不匹配导致高亮功能失效的问题
- 🔧 **修复**: 修复了页面跳转循环问题，优化了用户体验流程
- 🎨 **优化**: 视频文件命名规范化，区分不同结局的背景视频
- 📚 **文档**: 更新项目文档，同步最新功能和修复内容

### v1.4.0
- ✨ **新增**: 实现MusicManager音频管理系统，统一控制所有视频音频
- ✨ **新增**: 添加TransitionManager过渡效果管理器，提供多种电影级动画
- ✨ **新增**: 集成AssetLoader资源预加载器，优化游戏性能
- ✨ **新增**: 开发RouteManager路线管理系统，完善分支剧情管理
- 🎨 **优化**: 提升整体用户体验和视觉效果
- 📚 **文档**: 全面更新README.md，反映最新架构和功能

### v1.3.0
- ✨ **功能**: 新增"手动播放"状态指示器，提升用户体验
- ✨ **功能**: 实现"关于"页面内容的动态加载，与 `about.html` 同步
- ✨ **功能**: 增加自动/手动播放模式切换功能
- 🐛 **修复**: 解决了自动播放在特定条件下无法立即启动的问题
- 🐛 **修复**: 修复了"关于"页面内容无法滚动和样式丢失的问题
- 📚 **文档**: 更新 `README.md` 和 `CONTENT_INVENTORY.md` 以反映最新项目状态

### v1.2.0
- ✨ 完善四幕式剧情结构（30个对话场景）
- ✨ 添加梦境序章（4个神秘开场场景）
- ✨ 实现智能音频控制系统
- ✨ 添加页面过渡效果管理器
- ✨ 创建详细的内容清单管理系统
- 🐛 修复音乐控制按钮在初始加载时的显示问题

### v1.1.0
- ✨ 实现三条主要路线（EVA/Saber/D.Va）
- ✨ 添加多重结局系统
- ✨ 完善场景数据管理器
- 🎨 优化界面设计和用户体验

### v1.0.0
- 🎉 实现基础游戏框架
- ✨ 支持视频播放和分支选择
- ✨ 完成存档系统
- ✨ 添加响应式界面设计

## 🤝 贡献指南
欢迎提交Issue和Pull Request来改进游戏！

## 📄 许可证
本项目仅供学习和演示使用。